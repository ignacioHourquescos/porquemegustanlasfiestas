<!DOCTYPE html>
<html lang="es">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Me gustan las fiestas porque</title>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;800&family=Inter:wght@400;700;900&display=swap"
            rel="stylesheet">
      <style>
            * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
                  font-family: 'Space Grotesk', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            }

            body {
                  min-height: 100vh;
                  background: radial-gradient(1200px 800px at 10% 10%, #0a48ff 0%, rgba(10, 72, 255, 0.6) 35%, transparent 60%),
                        radial-gradient(900px 700px at 90% 20%, #0024a3 0%, rgba(0, 36, 163, 0.5) 40%, transparent 65%),
                        linear-gradient(135deg, #03154a 0%, #072d7a 50%, #0a3ea3 100%);
                  padding: 40px 20px;
                  overflow: hidden;
                  position: relative;
            }

            .wave-container {
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  pointer-events: none;
                  z-index: 1;
                  opacity: 0;
                  visibility: hidden;
            }

            .wave-container.active {
                  opacity: 1;
                  visibility: visible;
                  animation: fadeInOut 2s ease-in-out forwards;
            }

            .wave {
                  position: absolute;
                  width: 200%;
                  height: 200%;
                  background: linear-gradient(45deg,
                              #1b51ff,
                              /* Azul eléctrico */
                              #2b6bff,
                              /* Azul vivo */
                              #0a48ff,
                              /* Azul intenso */
                              #6ea3ff,
                              /* Azul claro */
                              #0f1b86
                              /* Azul profundo */
                        );
                  opacity: 0.35;
                  mix-blend-mode: screen;
                  transform-origin: center;
            }

            .wave1 {
                  animation: wave1 2s ease-in-out infinite;
            }

            .wave2 {
                  animation: wave2 2s ease-in-out infinite 0.2s;
            }

            .wave3 {
                  animation: wave3 2s ease-in-out infinite 0.4s;
            }

            .wave4 {
                  animation: wave4 2s ease-in-out infinite 0.6s;
            }

            @keyframes fadeInOut {
                  0% {
                        opacity: 0;
                  }

                  30% {
                        opacity: 0.4;
                  }

                  70% {
                        opacity: 0.4;
                  }

                  100% {
                        opacity: 0;
                  }
            }

            @keyframes wave1 {
                  0% {
                        transform: translate(-50%, -50%) rotate(0deg) scale(1) skew(0deg);
                  }

                  33% {
                        transform: translate(-45%, -55%) rotate(120deg) scale(1.2) skew(-5deg);
                  }

                  66% {
                        transform: translate(-55%, -45%) rotate(240deg) scale(1.1) skew(5deg);
                  }

                  100% {
                        transform: translate(-50%, -50%) rotate(360deg) scale(1) skew(0deg);
                  }
            }

            @keyframes wave2 {
                  0% {
                        transform: translate(-50%, -50%) rotate(90deg) scale(1.1) skew(5deg);
                  }

                  33% {
                        transform: translate(-55%, -45%) rotate(210deg) scale(1.3) skew(-5deg);
                  }

                  66% {
                        transform: translate(-45%, -55%) rotate(330deg) scale(1.2) skew(5deg);
                  }

                  100% {
                        transform: translate(-50%, -50%) rotate(450deg) scale(1.1) skew(-5deg);
                  }
            }

            @keyframes wave3 {
                  0% {
                        transform: translate(-50%, -50%) rotate(180deg) scale(1.2) skew(-5deg);
                  }

                  33% {
                        transform: translate(-45%, -55%) rotate(300deg) scale(1.4) skew(5deg);
                  }

                  66% {
                        transform: translate(-55%, -45%) rotate(420deg) scale(1.3) skew(-5deg);
                  }

                  100% {
                        transform: translate(-50%, -50%) rotate(540deg) scale(1.2) skew(5deg);
                  }
            }

            @keyframes wave4 {
                  0% {
                        transform: translate(-50%, -50%) rotate(270deg) scale(1.3) skew(5deg);
                  }

                  33% {
                        transform: translate(-55%, -45%) rotate(390deg) scale(1.5) skew(-5deg);
                  }

                  66% {
                        transform: translate(-45%, -55%) rotate(510deg) scale(1.4) skew(5deg);
                  }

                  100% {
                        transform: translate(-50%, -50%) rotate(630deg) scale(1.3) skew(-5deg);
                  }
            }

            .container {
                  position: fixed;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  text-align: left;
                  width: 90%;
                  max-width: 1400px;
                  z-index: 2;
            }

            .frase {
                  font-family: 'Space Grotesk', sans-serif;
                  font-size: 3rem;
                  line-height: 1.2;
                  color: #a6c0ff;
                  opacity: 0.4;
                  ;
                  white-space: normal;
                  text-shadow: 0 0 0 transparent;
                  letter-spacing: 0.12em;
                  text-transform: uppercase;
            }

            .razon {
                  font-family: 'Space Grotesk', sans-serif;
                  font-weight: 800;
                  font-size: clamp(1.2rem, 7.5vw, 7rem);
                  line-height: 0.9;
                  color: #ffffff;
                  display: block;
                  margin-top: 24px;
                  transition: all 0.5s ease-in-out;
                  text-shadow: 0 10px 24px rgba(0, 32, 122, 0.45);
                  letter-spacing: 0.02em;
                  text-transform: uppercase;
                  max-width: 90vw;
                  /* Forzar salto de línea en palabras muy largas */
                  overflow-wrap: anywhere;
                  word-break: break-word;
                  hyphens: auto;
            }

            @media (max-width: 768px) {

                  .frase {
                        font-size: 1rem;
                  }

                  .razon {
                        font-size: clamp(1.35rem, 8.5vw, 4rem);
                  }
            }

            @media (max-width: 480px) {

                  .frase {
                        font-size: 0.95rem;
                  }

                  .razon {
                        font-size: clamp(1.1rem, 9.5vw, 2.8rem);
                  }

                  .container {
                        width: 95%;
                  }
            }

            /* Marca: badge tipo "FREEquence" */
            .brand {
                  position: fixed;
                  top: 32px;
                  left: 60px;
                  z-index: 3;
                  color: #dce6ff;
                  text-shadow: none;

            }

            .brand-badge {
                  display: inline-flex;
                  align-items: stretch;
                  gap: 0;
                  border: 2px solid rgba(255, 255, 255, 0.8);
                  border-radius: 16px;
                  overflow: hidden;
                  backdrop-filter: blur(6px);
                  background: rgba(8, 22, 84, 0.25);
            }

            .brand-name {
                  font-family: 'Space Grotesk', sans-serif;
                  font-weight: 700;
                  letter-spacing: 0.06em;
                  padding: 10px 16px;
                  font-size: 18px;
                  color: #ffffff;
                  display: inline-flex;
                  align-items: center;
            }

            .brand-seg {
                  display: inline-flex;
                  align-items: center;
                  margin-left: 1rem;
                  justify-content: center;
                  padding: 8px 12px;
                  border-left: 2px solid rgba(255, 255, 255, 0.8);
                  background: rgba(255, 255, 255, 0.06);
            }

            .brand-tagline {
                  font-family: 'Syne Mono', monospace;
                  font-size: 12px;
                  margin-top: 8px;
                  opacity: 0.9;
                  letter-spacing: 0.06em;
            }

            /* Vibración sutil por letra */
            .glyph {
                  display: inline-block;
            }

            .char {
                  display: inline-block;
                  will-change: transform;
                  transform-origin: 50% 50%;
                  animation: subtle-jitter var(--dur, 0.3s) linear infinite;
            }

            .frase .char {
                  opacity: 0.7;
            }

            @keyframes subtle-jitter {
                  0% {
                        transform: translate(0, 0) rotate(0deg);
                  }

                  20% {
                        transform: translate(var(--amp, 1px), calc(var(--amp, 1px) * -0.5)) rotate(var(--rot, 0.2deg));
                  }

                  40% {
                        transform: translate(calc(var(--amp, 1px) * -0.6), calc(var(--amp, 1px) * 0.9)) rotate(calc(var(--rot, 0.2deg) * -1));
                  }

                  60% {
                        transform: translate(calc(var(--amp, 1px) * 0.5), calc(var(--amp, 1px) * 0.5)) rotate(calc(var(--rot, 0.2deg) * 0.6));
                  }

                  80% {
                        transform: translate(calc(var(--amp, 1px) * -0.4), calc(var(--amp, 1px) * -0.4)) rotate(calc(var(--rot, 0.2deg) * -0.4));
                  }

                  100% {
                        transform: translate(0, 0) rotate(0deg);
                  }
            }
      </style>
      <script src="/socket.io/socket.io.js"></script>
</head>

<body>
      <div class="brand">


            <span class="brand-seg" aria-hidden="true">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2" />
                        <circle cx="12" cy="12" r="2" fill="white" />
                        <path d="M12 3v6M21 12h-6M12 21v-6M3 12h6M17.657 6.343l-4.243 4.243M17.657 17.657l-4.243-4.243M6.343 17.657l4.243-4.243M6.343 6.343l4.243 4.243"
                              stroke="white" stroke-width="2" stroke-linecap="round" />
                  </svg>
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2" />
                        <circle cx="12" cy="12" r="2" fill="white" />
                        <path d="M12 3v6M21 12h-6M12 21v-6M3 12h6M17.657 6.343l-4.243 4.243M17.657 17.657l-4.243-4.243M6.343 17.657l4.243-4.243M6.343 6.343l4.243 4.243"
                              stroke="white" stroke-width="2" stroke-linecap="round" />
                  </svg>
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2" />
                        <circle cx="12" cy="12" r="2" fill="white" />
                        <path d="M12 3v6M21 12h-6M12 21v-6M3 12h6M17.657 6.343l-4.243 4.243M17.657 17.657l-4.243-4.243M6.343 17.657l4.243-4.243M6.343 6.343l4.243 4.243"
                              stroke="white" stroke-width="2" stroke-linecap="round" />
                  </svg>
            </span>

      </div>
      <div class="wave-container">
            <div class="wave wave1"></div>
            <div class="wave wave2"></div>
            <div class="wave wave3"></div>
            <div class="wave wave4"></div>
      </div>
      <div class="container">
            <h1 class="frase">¿Como elevas tu frecuencia?</h1>
            <div class="razon">...</div>
      </div>

      <script>
            const socket = io();
            const razonDiv = document.querySelector('.razon');
            const fraseEl = document.querySelector('.frase');
            const waveContainer = document.querySelector('.wave-container');
            let frases = [];
            let currentIndex = 0;
            let timeoutId = null;
            let incomingTimeoutId = null;

            // Función para calcular el tiempo de lectura basado en la longitud del texto
            function calcularTiempoLectura(texto) {
                  // Velocidad más lenta de lectura: aproximadamente 100 palabras por minuto
                  // Aproximadamente 15 caracteres por palabra en español
                  const CARACTERES_POR_PALABRA = 15;
                  const MS_POR_PALABRA = 600; // 600ms por palabra (el doble del tiempo anterior)
                  const TIEMPO_MINIMO = 5000; // Mínimo 5 segundos
                  const TIEMPO_MAXIMO = 15000; // Máximo 15 segundos

                  // Calculamos palabras aproximadas y tiempo necesario
                  const palabrasAproximadas = Math.ceil(texto.length / CARACTERES_POR_PALABRA);
                  const tiempoCalculado = palabrasAproximadas * MS_POR_PALABRA;

                  // Agregamos un tiempo extra para frases muy largas
                  const tiempoExtra = texto.length > 100 ? 2000 : 0; // 2 segundos extra para frases largas

                  // Aseguramos que el tiempo esté entre el mínimo y máximo
                  return Math.min(Math.max(tiempoCalculado + tiempoExtra, TIEMPO_MINIMO), TIEMPO_MAXIMO);
            }

            function getRandomTransform() {
                  const randomRotate = Math.random() * 360;
                  const randomScale = 0.8 + Math.random() * 0.7;
                  const randomSkew = -10 + Math.random() * 20;
                  const randomX = -60 + Math.random() * 20;
                  const randomY = -60 + Math.random() * 20;
                  return `translate(${randomX}%, ${randomY}%) rotate(${randomRotate}deg) scale(${randomScale}) skew(${randomSkew}deg)`;
            }

            // Normalizar carácter a su base sin acentos
            function normalizeBase(ch) {
                  return ch.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
            }

            function isAnyVowel(ch) {
                  const base = normalizeBase(ch);
                  return 'aeiou'.includes(base);
            }

            function isTargetVowel(ch, target) {
                  return normalizeBase(ch) === target;
            }

            function pickVowelForText(text) {
                  const present = new Set();
                  for (const ch of text) {
                        if (isAnyVowel(ch)) present.add(normalizeBase(ch));
                  }
                  if (present.size === 0) return 'e';
                  const arr = Array.from(present);
                  return arr[Math.floor(Math.random() * arr.length)];
            }

            // Envolver texto en spans por carácter y aplicar variables CSS solo a la vocal elegida
            function wrapTextWithCharSpans(element, text, options = {}) {
                  const {
                        ampMin = 0.8,
                        ampMax = 1.8,
                        rotMin = 0.1,
                        rotMax = 0.35,
                        durMin = 0.16,
                        durMax = 0.36,
                        vowel
                  } = options;

                  element.innerHTML = '';
                  const activeVowel = vowel ?? pickVowelForText(text);

                  for (const ch of text) {
                        if (ch === ' ') {
                              element.appendChild(document.createTextNode(' '));
                              continue;
                        }
                        const span = document.createElement('span');
                        span.className = 'glyph';
                        if (isTargetVowel(ch, activeVowel)) {
                              span.classList.add('char');
                              const amp = (ampMin + Math.random() * (ampMax - ampMin)).toFixed(2) + 'px';
                              const rot = (rotMin + Math.random() * (rotMax - rotMin)).toFixed(2) + 'deg';
                              const dur = (durMin + Math.random() * (durMax - durMin)).toFixed(2) + 's';
                              span.style.setProperty('--amp', amp);
                              span.style.setProperty('--rot', rot);
                              span.style.setProperty('--dur', dur);
                              span.style.animationDelay = (Math.random() * 0.2).toFixed(2) + 's';
                        }
                        span.textContent = ch;
                        element.appendChild(span);
                  }
            }

            function triggerWaveAnimation() {
                  waveContainer.classList.remove('active');
                  void waveContainer.offsetWidth;

                  document.querySelectorAll('.wave').forEach(wave => {
                        wave.style.transform = getRandomTransform();
                  });

                  waveContainer.classList.add('active');

                  setTimeout(() => {
                        waveContainer.classList.remove('active');
                  }, 2000);
            }

            function mostrarSiguienteFrase() {
                  if (frases.length === 0) return;

                  razonDiv.style.opacity = '0';
                  razonDiv.style.transform = 'translateY(20px)';

                  setTimeout(() => {
                        const fraseActual = frases[currentIndex];
                        const vowel = pickVowelForText(fraseActual.texto);
                        wrapTextWithCharSpans(razonDiv, fraseActual.texto, { ampMin: 1.0, ampMax: 2.0, rotMin: 0.12, rotMax: 0.35, durMin: 0.12, durMax: 0.28, vowel });
                        razonDiv.style.opacity = '1';
                        razonDiv.style.transform = 'translateY(0)';

                        // Calcular el tiempo para la siguiente frase
                        currentIndex = (currentIndex + 1) % frases.length;
                        const siguienteFrase = frases[currentIndex];
                        const tiempoEspera = calcularTiempoLectura(fraseActual.texto);

                        // Programar la siguiente frase
                        clearTimeout(timeoutId);
                        timeoutId = setTimeout(mostrarSiguienteFrase, tiempoEspera);
                  }, 500);
            }

            // Cargar frases iniciales
            fetch('/frases')
                  .then(response => response.json())
                  .then(data => {
                        frases = data.frases;
                        if (frases.length > 0) {
                              const vowel = pickVowelForText(frases[0].texto);
                              wrapTextWithCharSpans(razonDiv, frases[0].texto, { ampMin: 1.0, ampMax: 2.0, rotMin: 0.12, rotMax: 0.35, durMin: 0.12, durMax: 0.28, vowel });
                              // Iniciar el ciclo con el tiempo calculado para la primera frase
                              const tiempoInicial = calcularTiempoLectura(frases[0].texto);
                              timeoutId = setTimeout(mostrarSiguienteFrase, tiempoInicial);
                        }
                  });

            // Escuchar nuevas frases
            socket.on('nueva_frase', (frase) => {
                  frases.unshift(frase);
                  currentIndex = 0;
                  clearTimeout(timeoutId);

                  if (incomingTimeoutId) {
                        clearTimeout(incomingTimeoutId);
                  }

                  // Mostrar la nueva frase con un delay de 1 segundo
                  incomingTimeoutId = setTimeout(() => {
                        const vowel = pickVowelForText(frase.texto);
                        wrapTextWithCharSpans(razonDiv, frase.texto, { ampMin: 1.0, ampMax: 2.0, rotMin: 0.12, rotMax: 0.35, durMin: 0.12, durMax: 0.28, vowel });
                        triggerWaveAnimation();

                        // Programar la siguiente frase con el tiempo calculado
                        const tiempoEspera = calcularTiempoLectura(frase.texto);
                        timeoutId = setTimeout(mostrarSiguienteFrase, tiempoEspera);
                  }, 1000);
            });

            // Aplicar vibración al título estático
            wrapTextWithCharSpans(fraseEl, fraseEl.textContent, { ampMin: 0.6, ampMax: 1.4, rotMin: 0.08, rotMax: 0.25, durMin: 0.18, durMax: 0.36, vowel: pickVowelForText(fraseEl.textContent) });
      </script>
</body>

</html>